# 中创中间件应用服务器 V10 在 CentOS 7 上的安装与使用教程（压缩包安装）

本教程为在中创中间件应用服务器（InforSuite Application Server）V10.0.5.3.9 在 CentOS 7 系统上使用 **压缩包（.zip）** 方式的安装和使用提供详细指导，内容基于官方产品手册（快速使用手册、安装手册和用户使用手册）整理，并补充了常用参数调整和缺失的命令（如环境变量设置）。文档确保清晰简洁，适合运维人员、开发人员和评估人员。

## 1. 前置条件

在开始安装之前，请确保系统满足以下要求并正确配置 Java 环境。

### 1.1 系统要求

| 系统组件         | 要求                                          |
| ------------ | ------------------------------------------- |
| **操作系统**     | CentOS 7（或其他 RedHat 系列 Linux 系统）            |
| **Java 环境**  | JDK 1.8、JDK 11、JDK 17 或 JDK 21              |
| **内存**       | 2 GB 或以上                                    |
| **硬盘空间**     | 10 GB 或以上                                   |
| **浏览器（管理端）** | Firefox 55+、Microsoft Internet Explorer 10+ |

### 1.2 配置 Java 环境（以 JDK 8 为例）

中创中间件应用服务器需要安装并配置兼容的 Java 开发工具包（JDK）。

1. **检查现有 Java 环境**：
   在终端运行以下命令，检查是否已安装兼容的 JDK：
   
   ```bash
   java -version
   ```
   
   如果显示 JDK 1.8 或其他支持的版本（如 11、17、21），可跳过安装步骤。

2. **安装 JDK（若未安装）**：
   如果系统中没有 JDK，可通过以下方式安装 JDK 1.8：
   
   - 使用 CentOS 包管理器安装 OpenJDK 8：
     
     ```bash
     yum install java-1.8.0-openjdk java-1.8.0-openjdk-devel -y
     ```
   - 或者，从 Oracle 官方网站下载并安装 JDK 1.8（需登录 Oracle 账户）：
     
     ```
     http://www.oracle.com/technetwork/java/javase/downloads/index.html
     ```
     
     下载后，解压并移动到 `/usr/java/`：
     
     ```bash
     tar -xzf jdk-8u231-linux-x64.tar.gz
     mv jdk1.8.0_231 /usr/java/
     ```

3. **配置环境变量**：
   为确保系统能找到 JDK，需要设置环境变量。
   
   - 以 `root` 用户登录：
     
     ```bash
     su
     ```
   - 编辑系统配置文件：
     
     ```bash
     vi /etc/profile
     ```
   - 在文件末尾添加以下内容，将 `/usr/java/jdk1.8.0_231` 替换为您实际的 JDK 安装路径：
     
     ```bash
     export JAVA_HOME=/usr/java/jdk1.8.0_231
     export PATH=$JAVA_HOME/bin:$PATH
     export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
     ```
   - 保存并退出（在 `vi` 中按 `Esc`，输入 `:wq` 后回车）。
   - 使环境变量立即生效：
     
     ```bash
     source /etc/profile
     ```
   - 或者，针对当前用户配置环境变量（若不使用 `root`）：
     
     ```bash
     vi ~/.bashrc
     ```
     
     添加相同的 `export` 语句，保存后运行：
     
     ```bash
     source ~/.bashrc
     ```

4. **验证配置**：
   运行以下命令验证 JDK 安装：
   
   ```bash
   java -version
   ```
   
   输出应类似于：
   
   ```
   java version "1.8.0_231"
   Java(TM) SE Runtime Environment (build 1.8.0_231-b11)
   Java HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)
   ```

## 2. 安装过程（压缩包方式）

在 CentOS 7 环境下，使用 `.zip` 压缩包安装中创中间件应用服务器。

### 2.1 准备安装程序

1. 以 `root` 用户登录：
   
   ```bash
   su
   ```

2. 创建安装目录：
   
   ```bash
   mkdir /opt/CVICSE/InforSuite
   ```

3. 将压缩包（例如 `InforSuiteAS_V10.0.5.3.9.zip`）拷贝至安装目录：
   
   ```bash
   cp /path/to/InforSuiteAS_V10.0.5.3.9.zip /opt/CVICSE/InforSuite/
   ```
   
   替换 `/path/to/` 为实际压缩包路径。

4. 解压压缩包：
   
   ```bash
   cd /opt/CVICSE/InforSuite
   unzip InforSuiteAS_V10.0.5.3.9.zip
   ```
   
   解压后，目录结构将包含 `AppServer` 等文件夹。

5. **设置许可证**：
   将授权文件重命名为 `license.infor` 并放入 `AppServer/as/` 目录：
   
   ```bash
   mv /path/to/license-file /opt/CVICSE/InforSuite/AppServer/as/license.infor
   ```
   
   确保许可证文件与产品版本匹配且未过期。

### 2.2 创建域

压缩包安装的包默认不包含域，需手动创建域（例如 `domain1`）。

1. 进入 `bin` 目录：
   
   ```bash
   cd /opt/CVICSE/InforSuite/AppServer/bin
   ```

2. 赋予 `asadmin` 脚本可执行权限：
   
   ```bash
   chmod +x asadmin
   ```

3. 创建域：
   
   ```bash
   ./asadmin create-domain --adminport 8060 domain1
   ```
   
   - `--adminport 8060` 指定管理端口（默认 8060）。
   - `domain1` 为域名称，可自定义。
   - 运行时会提示设置 `inforsAdmin` 用户的密码，密码需 8-32 字符，包含大写字母、小写字母、数字和特殊字符中的至少三种。

4. 验证域创建：
   检查 `/opt/CVICSE/InforSuite/AppServer/as/domains/domain1` 目录是否存在，包含 `config/domain.xml` 等文件。

## 3. 基本服务器操作

安装完成后，可使用 `asadmin` 脚本启动、停止和管理服务器。

### 3.1 目录结构

安装后的关键目录如下：

| 目录                                          | 描述                          |
| ------------------------------------------- | --------------------------- |
| `AppServer/as/bin`                          | 包含服务器操作的命令脚本（如 `asadmin`）   |
| `AppServer/as/domains`                      | 包含每个域的配置和运行时文件（如 `domain1`） |
| `AppServer/as/domains/<domain-name>/config` | 包含域的核心配置文件，如 `domain.xml`   |
| `AppServer/as/domains/<domain-name>/logs`   | 服务器日志文件存放位置                 |
| `AppServer/as/`                             | 放置 `license.infor` 许可证文件的位置 |

### 3.2 许可证

- 压缩包安装不包含试用许可证，需手动放置 `license.infor` 文件至 `AppServer/as/` 目录。
- 确保许可证文件有效且与产品版本匹配。若无许可证，服务器启动将报版权控制错误。

### 3.3 启动服务器

推荐使用 `asadmin` 脚本以后台进程方式启动服务器。

1. 进入 `bin` 目录：
   
   ```bash
   cd /opt/CVICSE/InforSuite/AppServer/bin
   ```
2. 启动域：
   
   ```bash
   ./asadmin start-domain domain1
   ```
   - 替换 `domain1` 为实际域名称。
   - **首次启动**：若未在创建域时设置 `inforsAdmin` 密码，系统会提示设置，密码需符合要求（8-32 字符，包含三种字符类型）。
   - **后续启动**：服务器将直接在后台启动。
3. 启动成功后，会显示管理端口（默认 8060）等信息。验证启动：
   
   ```bash
   ps aux | grep java
   ```
   
   检查是否有 Java 进程运行。

### 3.4 停止服务器

1. 进入 `bin` 目录：
   
   ```bash
   cd /opt/CVICSE/InforSuite/AppServer/bin
   ```
2. 停止域：
   
   ```bash
   ./asadmin stop-domain domain1
   ```
   - 替换 `domain1` 为实际域名称。
3. 停止成功后会显示确认信息。验证停止：
   
   ```bash
   ps aux | grep java
   ```
   
   确认 Java 进程已终止。

## 4. 使用管理控制台

管理控制台是基于 Web 的工具，用于配置和监控服务器。

### 4.1 登录控制台

1. 在浏览器中访问：
   
   ```
   http://<服务器IP>:8060/console
   ```
   
   或
   
   ```
   https://<服务器IP>:8060/console
   ```
   
   替换 `<服务器IP>` 为实际服务器 IP 地址。

2. 使用以下用户凭据登录：
   
   - **系统管理员**：用户名 `inforsAdmin`，密码为创建域或首次启动时设置的密码。
   - **安全管理员**：用户名 `inforsSecurityUser`，默认密码 `Cvicse@as123`（默认禁用）。
   - **审计管理员**：用户名 `inforsAuditUser`，默认密码 `Cvicse@as123`（默认禁用）。
   - **启用安全/审计管理员**：
     - 编辑域配置文件：
       
       ```bash
       vi /opt/CVICSE/InforSuite/AppServer/as/domains/domain1/config/domain.xml
       ```
     - 找到 `<login-conf>` 标签，将 `default-user` 属性改为 `true`：
       
       ```xml
       <login-conf default-user="true">
       ```
     - 保存后重启域。
   - **注意**：首次登录默认密码（如 `Cvicse@as123`）时，系统会提示更改密码。

### 4.2 控制台概览

控制台界面分为三个主要区域：

- **顶部工具栏**：显示用户名、域、IP 地址，提供语言切换和退出选项。
- **左侧导航树**：提供所有管理功能入口，包括 `Applications`（应用）、`Resources`（资源）、`Configuration`（配置）、`Clusters`（集群）和 `Nodes`（节点）。
- **中心功能区域**：显示从导航树选择的功能页面。

## 5. 部署示例应用

以下介绍如何部署一个连接数据库的 Web 应用，包括配置 JDBC 数据源和部署 `.war` 文件。

### 5.1 配置 JDBC 数据源

配置分为两步：创建连接池和创建 JDBC 资源。

1. **创建 JDBC 连接池**：
   
   - 在管理控制台中，导航至 **资源 → JDBC → JDBC 连接池**。
   - 点击 **新建** 启动向导。
   - **步骤 1（常规设置）**：
     - **连接池名称**：输入唯一名称（如 `mysqlpool`）。
     - **资源类型**：选择 `java.sql.Driver`。
     - **数据库供应商**：选择数据库类型（如 `MySql`）。
   - 点击 **下一步**。
   - **步骤 2（属性设置）**：
     - 在“附加属性”部分添加数据库连接属性，例如：
       
       ```
       user: <数据库用户名>
       password: <数据库密码>
       URL: jdbc:mysql://localhost:3306/mytest?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=GMT
       ```
     - 对于 MySQL 8.0+，确保 URL 包含 `serverTimezone` 参数。
   - 点击 **完成** 保存连接池。保存后，点击 **Ping** 按钮验证连接。
   - **验证连接命令**（可选，命令行方式）：
     
     ```bash
     ./asadmin ping-connection-pool mysqlpool
     ```

2. **创建 JDBC 资源**：
   
   - 导航至 **资源 → JDBC → JDBC 资源**。
   - 点击 **新建**。
   - 填写信息：
     - **JNDI 名称**：应用用于查找数据源的名称（如 `jdbc/MyFirstDataSource`）。
     - **连接池名称**：从下拉列表选择刚创建的连接池（如 `mysqlpool`）。
   - 点击 **确定** 创建资源。
   - **命令行创建资源**（可选）：
     
     ```bash
     ./asadmin create-jdbc-resource --connectionpoolid mysqlpool jdbc/MyFirstDataSource
     ```

### 5.2 部署应用

1. 在导航树中点击 **应用程序**。
2. 点击 **部署** 按钮。
3. 选择“上传到服务器的打包文件”，浏览并选择应用的 `.war` 文件。
4. 在下一页配置部署选项，重点包括：
   - **上下文根**：应用的 URL 路径（如 `my-app`）。
   - **应用名称**：在控制台中的描述性名称。
   - **可用性**：勾选以启用集群中的会话复制等功能。
5. 点击 **确定** 完成部署，应用将出现在已部署应用列表中。
6. **命令行部署**（可选）：
   
   ```bash
   ./asadmin deploy --contextroot my-app /path/to/my-app.war
   ```

### 5.3 访问应用

1. 在 **应用程序** 页面，找到已部署的应用。
2. 点击 **URL** 列中的链接查看访问地址。
3. 点击 URL，在新标签页打开应用，典型 URL 格式为：
   
   ```
   http://<服务器IP>:8080/my-app
   ```

## 6. 常见问题排查

- **安装时文字乱码**：
  如果解压或运行脚本时出现乱码，设置终端字符编码为 GBK：
  
  ```bash
  export LC_ALL=zh_CN.GBK
  ```

- **端口 8060 被占用**：
  如果启动失败并提示端口 8060 被占用：
  
  - 查找占用端口的进程：
    
    ```bash
    netstat -lnp | grep 8060
    ```
  - 终止进程（将 `<PID>` 替换为实际进程 ID）：
    
    ```bash
    kill -9 <PID>
    ```

- **版权控制或许可证错误**：
  如果启动时报告许可证错误：
  
  - 确保 `license.infor` 文件存在于 `AppServer/as/` 目录：
    
    ```bash
    ls /opt/CVICSE/InforSuite/AppServer/as/license.infor
    ```
  - 确认许可证与产品版本匹配且未过期。如需新许可证，联系支持团队：`support@cvicse.com`。

- **服务器启动后，无法正常关闭**：
  检查日志文件：
  
  ```bash
  cat /opt/CVICSE/InforSuite/AppServer/as/domains/domain1/logs/server.log
  ```
  
  若因资源锁定，强制停止：
  
  ```bash
  ./asadmin stop-domain --force domain1
  ```

## 7. 常用参数调整

以下为常用参数调整方法，用于优化服务器性能。

### 7.1 JVM 参数调整

在管理控制台中，导航至 **配置 → 配置名称 → JVM 设置**。

- **常规设置**：调整堆大小、垃圾回收策略。
- **JVM 选项**：添加自定义选项，例如：
  
  ```bash
  -Xms1024m -Xmx2048m
  ```
  
  设置初始堆 1GB，最大堆 2GB。
- **命令行调整**：
  编辑 `domain.xml`：
  
  ```bash
  vi /opt/CVICSE/InforSuite/AppServer/as/domains/domain1/config/domain.xml
  ```
  
  在 `<jvm-options>` 标签中添加：
  
  ```xml
  <jvm-options>-Xms1024m</jvm-options>
  <jvm-options>-Xmx2048m</jvm-options>
  ```
  
  保存后重启域：
  
  ```bash
  ./asadmin restart-domain domain1
  ```

### 7.2 线程池设置

导航至 **配置 → 配置名称 → 线程池**。

- 设置最大线程数（如 200）、最小线程数（如 10）、空闲超时（如 600 秒）。
- **命令行设置**：
  
  ```bash
  ./asadmin create-threadpool --maxthreadpoolsize 200 --minthreadpoolsize 10 --idletimeout 600 threadpool-1
  ```
  
  重启域生效。

### 7.3 JDBC 连接池设置

在 **资源 → JDBC → JDBC 连接池**，选择池并编辑。

- 调整最大连接数（如 50）、连接泄漏超时（如 300 秒）。
- **命令行设置**：
  
  ```bash
  ./asadmin set resources.jdbc-connection-pool.mysqlpool.property.maxPoolSize=50
  ./asadmin set resources.jdbc-connection-pool.mysqlpool.property.connectionLeakTimeout=300
  ```
  
  测试连接：
  
  ```bash
  ./asadmin ping-connection-pool mysqlpool
  ```

### 7.4 HTTP 连接池设置

导航至 **配置 → 配置名称 → HTTP 服务**。

- 设置最大连接数（如 1024）、队列大小。
- **命令行设置**：
  
  ```bash
  ./asadmin set server.http-service.http-listener.http-listener-1.max-connections=1024
  ```
  
  重启域生效。

### 7.5 日志相关参数设置

导航至 **配置 → 配置名称 → 日志设置**。

- **查看日志**：
  
  ```bash
  tail -f /opt/CVICSE/InforSuite/AppServer/as/domains/domain1/logs/server.log
  ```
- **设置日志级别**（如 FINE）：
  
  ```bash
  ./asadmin set-log-levels java.util.logging.ConsoleHandler=FINE
  ```
- **设置最大日志文件数**（如 10）：
  
  ```bash
  ./asadmin set server.log-service.file.rotation-limit=10
  ```
- **关闭访问日志**：
  
  ```bash
  ./asadmin set server.http-service.access-logging-enabled=false
  ```
- 重启域生效。

# 
